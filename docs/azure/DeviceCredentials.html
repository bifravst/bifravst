

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Device credentials &mdash; Bifravst v10.4.8 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Connect using the simulator" href="Simulator.html" />
    <link rel="prev" title="Upgrading an existing installation" href="Upgrading.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../README.html">
          

          
            
            <img src="../../_static/logo-with-text-white.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                v10.4.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../aws/Index.html">Bifravst on AWS</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Index.html">Bifravst on Azure</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="GettingStarted.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="RunningInDocker.html">Running the application locally with Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="Upgrading.html">Upgrading an existing installation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Device credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="Simulator.html">Connect using the simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="ContinuousDeployment.html">Continuous deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="ContinuousIntegration.html">Continuous integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="UnwiredLabsAPI.html">Unwired Labs’ LocationAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="IoTShadowAndTopics.html">Azure IoT Shadow and Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="secure-azure-function-apps-with-microsoft-b2c.html">Using Azure AD B2C to secure your Azure Functions Apps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../app/Index.html">Cat Tracker Web Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firmware/Index.html">Cat Tracker firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devices/Index.html">Connect using a real device</a></li>
</ul>
<p class="caption"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guides/AutomateHEXFileBuilding.html">Automate building of HEX files for your nRF Connect SDK application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/CellGeolocations.html">Cell Geolocations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/Cloud-connectivity-and-protocols-for-the-Internet-of-Things.html">Cloud connectivity and protocols for the Internet of Things</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/CloudDifferences.html">Cloud Differences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/ETSI-EN-303-645.html">Cyber Security for Consumer Internet of Things: Baseline Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/Versioning.html">Versioning</a></li>
</ul>
<p class="caption"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bifravst">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://devzone.nordicsemi.com/search?q=bifravst#serpsort=date%20desc">DevZone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adr/README.html">Architecture Decision Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CODE_OF_CONDUCT.html">Code of Conduct</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../README.html">Bifravst</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../README.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="Index.html">Bifravst on Azure</a> &raquo;</li>
        
      <li>Device credentials</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/bifravst/bifravst/blob/saga/docs/azure/DeviceCredentials.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="device-credentials">
<span id="azure-device-credentials"></span><h1>Device credentials<a class="headerlink" href="#device-credentials" title="Permalink to this headline">¶</a></h1>
<p>On Azure devices, connect to IoT Hub using <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-fundamentals/iot-security-deployment">TLS version 1.2</a> and Elliptic Curve Cryptography (ECC) based certificates.</p>
<p>Azure supports offline generation of device certificates through <a class="reference external" href="https://docs.microsoft.com/bs-latn-ba/azure/iot-dps/quick-enroll-device-x509-node">Enrollment Groups</a>.</p>
<p>Device certificates are signed by using an intermediate CA.
Following are the advantages of using an intermediate CA:</p>
<ul class="simple">
<li><p>The CA root certificate remains secure since an intermediate CA certificate is created for use during device provisioning.</p></li>
<li><p>The CA root certificate private key will never be transmitted to insecure locations (for example, a third-party factory).</p></li>
</ul>
<p>If the intermediate CA certificate is compromised, it can be deactivated.
New devices with credentials signed by the compromised intermediate CA certificate will no longer be provisioned.</p>
<p>Devices that previously connected to the IoT Hub, will continue to work.</p>
<div class="section" id="device-provisioning-service">
<h2>Device Provisioning Service<a class="headerlink" href="#device-provisioning-service" title="Permalink to this headline">¶</a></h2>
<p>Devices connect to IoT Hub using the <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-dps/">Device Provisioning Service (DPS)</a>.
DPS allows better management of roaming devices.
However, it requires an extra connection step.
Following are the overall connection steps:</p>
<ul class="simple">
<li><p>Connect to DPS to retrieve the endpoint configuration</p></li>
<li><p>Connect to the IoT Hub endpoint.</p></li>
</ul>
<p>This is a one-time operation, and the device can cache its associated IoT Hub endpoint.</p>
</div>
<div class="section" id="creating-device-credentials">
<h2>Creating device credentials<a class="headerlink" href="#creating-device-credentials" title="Permalink to this headline">¶</a></h2>
<p>For creating device credentials, you must generate the following certificates:</p>
<ul class="simple">
<li><p>CA root certificate</p></li>
<li><p>CA intermediate certificate</p></li>
<li><p>Device certificate</p></li>
</ul>
<div class="section" id="create-a-ca-root-certificate">
<h3>Create a CA root certificate<a class="headerlink" href="#create-a-ca-root-certificate" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure that you have exported the right resource group name as <code class="docutils literal notranslate"><span class="pre">$RESOURCE_GROUP_NAME</span></code>.
By default, it is set to <code class="docutils literal notranslate"><span class="pre">bifravst</span></code>.</p>
</div>
<p>To create a CA root certificate and register it with the Azure IoT Device Provisioning Service, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node cli create-ca-root
</pre></div>
</div>
<p>The CA root certificate should not be shared.
The number of CA root certificates is typically very small, and the minimum number of certificates required is one.</p>
<p>Provide the proof your ownership of the CA with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node cli proof-ca-root-possession
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you see the error <em>“A required certificate is not within its validity period when verifying against the current system clock or the timestamp in the signed file.”</em>, confirm that your system clock is accurate.</p>
</div>
</div>
<div class="section" id="create-a-ca-intermediate-certificate">
<h3>Create a CA intermediate certificate<a class="headerlink" href="#create-a-ca-intermediate-certificate" title="Permalink to this headline">¶</a></h3>
<p>To creates a CA intermediate certificate and an enrollment group for it, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node cli create-ca-intermediate
</pre></div>
</div>
<p>You can share the CA intermediate certificate with the factory.
Over time, you will have multiple intermediate certificates.</p>
</div>
<div class="section" id="create-a-device-certificate">
<h3>Create a device certificate<a class="headerlink" href="#create-a-device-certificate" title="Permalink to this headline">¶</a></h3>
<p>Run the following script to generate a certificate for a new device:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node cli create-device-cert
</pre></div>
</div>
<p>A device will initially connect to DPS using the certificate and place a request to be provisioned.
The DPS registers the device on the associated IoT Hub and returns the registration information to the device, which includes the hostname of the assigned IoT Hub.</p>
<p>The device then terminates the connection to the DPS and initiate a new connection to the IoT Hub endpoint.
The device should store the registration information so that it can directly connect to the assigned IoT Hub endpoint when the device boots up next time.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Simulator.html" class="btn btn-neutral float-right" title="Connect using the simulator" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Upgrading.html" class="btn btn-neutral float-left" title="Upgrading an existing installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019-2021, Nordic Semiconductor ASA | nordicsemi.no.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>