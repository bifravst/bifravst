

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Using Azure AD B2C to secure your Azure Functions Apps &mdash; Bifravst v10.4.8 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Cat Tracker Web Application" href="../app/Index.html" />
    <link rel="prev" title="Azure IoT Shadow and Topics" href="IoTShadowAndTopics.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../README.html">
          

          
            
            <img src="../../_static/logo-with-text-white.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                v10.4.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../aws/Index.html">Bifravst on AWS</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Index.html">Bifravst on Azure</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="GettingStarted.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="RunningInDocker.html">Running the application locally with Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="Upgrading.html">Upgrading an existing installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="DeviceCredentials.html">Device credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="Simulator.html">Connect using the simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="ContinuousDeployment.html">Continuous deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="ContinuousIntegration.html">Continuous integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="UnwiredLabsAPI.html">Unwired Labs’ LocationAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="IoTShadowAndTopics.html">Azure IoT Shadow and Topics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using Azure AD B2C to secure your Azure Functions Apps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../app/Index.html">Cat Tracker Web Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firmware/Index.html">Cat Tracker firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devices/Index.html">Connect using a real device</a></li>
</ul>
<p class="caption"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guides/AutomateHEXFileBuilding.html">Automate building of HEX files for your nRF Connect SDK application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/CellGeolocations.html">Cell Geolocations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/Cloud-connectivity-and-protocols-for-the-Internet-of-Things.html">Cloud connectivity and protocols for the Internet of Things</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/CloudDifferences.html">Cloud Differences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/ETSI-EN-303-645.html">Cyber Security for Consumer Internet of Things: Baseline Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/Versioning.html">Versioning</a></li>
</ul>
<p class="caption"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bifravst">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://devzone.nordicsemi.com/search?q=bifravst#serpsort=date%20desc">DevZone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adr/README.html">Architecture Decision Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CODE_OF_CONDUCT.html">Code of Conduct</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../README.html">Bifravst</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../README.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="Index.html">Bifravst on Azure</a> &raquo;</li>
        
      <li>Using Azure AD B2C to secure your Azure Functions Apps</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/bifravst/bifravst/blob/saga/docs/azure/secure-azure-function-apps-with-microsoft-b2c.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-azure-ad-b2c-to-secure-your-azure-functions-apps">
<h1>Using Azure AD B2C to secure your Azure Functions Apps<a class="headerlink" href="#using-azure-ad-b2c-to-secure-your-azure-functions-apps" title="Permalink to this headline">¶</a></h1>
<p>Manual Guide by <a class="reference external" href="https://docs.microsoft.com/answers/answers/40449/view.html">Saurabh Sharma</a>.</p>
<p>If you want to use Azure Function Apps and need a way to secure access to your Function Apps – that is, only allowing authenticated users, then Azure AD B2C is a great solution.
It allows users to create their own accounts or using a social identity provider, and gain access to the your Function apps only after they have successfully authenticated.
This document is a step-by-step guide to configuring Azure AD B2C, as the identity provider for your Azure Function Apps.</p>
<ol class="arabic">
<li><p>Create your Azure function app – easiest way is to select <strong>+Create a Resource</strong> , type in “function app” to find it, select Function App, and select <strong>Create</strong></p>
<img alt="1" src="../../_images/01.png" />
</li>
<li><p>Enter your unique Azure Function App name – copy the name to a text editor -we will need it in subsequent steps.
Complete the rest of the information and select <strong>Create</strong>.</p>
<img alt="2" src="../../_images/02.png" />
</li>
<li><p>Go back to the Function App blade in the Azure Portal, and select the Azure function app that you created.
From the Function App blade, select Platform Features and then select Authentication/Authorization.</p>
<img alt="3" src="../../_images/03.png" />
</li>
<li><p>Move the App Service Authentication to the On Position, which then expose a number of settings available for Authentication.
Note that the default is “Allow Anonymous request” – allowing any user to access your function application.</p>
<img alt="4" src="../../_images/04.png" />
</li>
<li><p>We will now select “Log in with Azure Active Directory”, which is one of the available options in the drop down box labeled “Action to take when request is not authenticated”</p>
<img alt="5" src="../../_images/05.png" />
</li>
<li><p>After this select “Azure Active Directory” under the list of Authentication Providers, this will open a new configuration blade, select “Advanced” and note the required fields, including Client ID and Issuer Uri – the Client Secret and Allowed Token Audiences are option fields.
Go to the next steps to collect the application Client ID and Issuer URI values from B2C.</p>
<img alt="6" src="../../_images/06.png" />
</li>
<li><p>Create a new B2C application.
From the Azure Portal (optionally, you can open a separate browser tab or new browser session, keeping the previous blade open/available), go to your B2C Tenant Blade, and select Applications, then select +Add to create a New Application.
In the New Application blade, give the app a friendly name, Select <em>Yes</em> for Web App/ Web API option, in the Reply URL section, enter in the full Azure website name that you created in step 2, and append it with: <code class="docutils literal notranslate"><span class="pre">/.auth/login/aad/callback</span></code>. For example: <code class="docutils literal notranslate"><span class="pre">https://myAppSecuredByB2C.azurewebites.net/.auth/login/aad/callback</span></code>.
Select Create.</p>
<img alt="7" src="../../_images/07.png" />
</li>
<li><p>Collect B2C Application ID.
After successfully creating the application, go back to the B2C Admin Portal Application blade, find your newly created application and open the profile to collect the Application ID – copy this B2C application ID – this will be used to finish the Azure Function configuration.</p>
<img alt="8" src="../../_images/08.png" />
</li>
<li><p>Collect B2C OpenID Connect Metadata URL endpoint.
Go to the top level Azure AD B2C blade, and select User Journeys, and select a Sign In Sign Up policy (or any other policy that you have created, and select the “Run user flow” button – once the blade is opened copy the Openid Metadata endpoint</p>
<img alt="9" src="../../_images/09.png" />
</li>
<li><p>Return to the Azure Function blade, and navigate to the Platform Settings -&gt; Authentication/Authorization -&gt; Azure Active Directory Settings – enter the B2C Application ID into the <strong>Client ID</strong> property.
Similarly, enter in the B2C Open ID Connect metadata URL into the <strong>Issuer URI</strong> property.
Select OK to finish the configuration.</p>
<img alt="10" src="../../_images/10.png" />
</li>
<li><p>Validation and Testing.
The configuration on both the B2C application side as well as the Azure Function is now complete.</p>
<ol class="arabic">
<li><p>Attempting to access your Function App will now require authentication.
Validate that un-authenticated users will get prompted to complete their B2C sign-in before being allowed access to your Function App.
This can be easily executed from the Run userflow button from each B2C User Flow Policy.
Make sure to select the Application representing your Azure Function App in the Application drop down picker dialog, and the associated Reply URL (in some cases you many have more than one reply URL).</p>
<img alt="11" src="../../_images/11.png" />
</li>
<li><p>Other tests</p>
<ol class="arabic simple">
<li><p>Clear browser session cookies, validate that user must authenticate when attempt to access your Azure Function.</p></li>
<li><p>After successful Function App access, try opening a separate browser tab, and validate that you can automatically sign-in.</p></li>
<li><p>Try to run other user flows, such as password reset or profile edit, with your Azure Function – after the users complete these flows, the will be redirected to the Azure Function App.</p></li>
</ol>
</li>
</ol>
</li>
</ol>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../app/Index.html" class="btn btn-neutral float-right" title="Cat Tracker Web Application" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="IoTShadowAndTopics.html" class="btn btn-neutral float-left" title="Azure IoT Shadow and Topics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019-2021, Nordic Semiconductor ASA | nordicsemi.no.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>